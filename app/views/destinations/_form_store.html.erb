<%= form_for(@destination, html:{class:"form-horizontal"}) do |f| %>
  <% if @destination.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@destination.errors.count, "error") %> prohibited this destination from being saved:</h2>

      <ul>
      <% @destination.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="row">
    <%= f.label :name, class:"col-lg-2 control-label" %>
    <span class="col-lg-4"><%= f.text_field :name, class:"form-control" %></span>
  </div>
  <div class="row">
    <%= f.label :address, class:"col-lg-2 control-label" %>
    <div class="col-lg-4 block">
      <span>
        <input class="form-control" type="text" name="destination[street]" value="<%= @destination.street %>"/>
      </span>
      <span style="width:4em">
        <input class="form-control" type="text" maxlength="7" width="7" name="destination[postalcode]" value="<%= @destination.postalcode %>"/>
      </span>
      <span>
        <div class="input-group">
          <input class="form-control" type="text" name="destination[city]" value="<%= @destination.city %>"/>
          <span class="input-group-addon pointing"><i class="icon-screenshot"></i></span>
        </div>
      </span>
    </div>
  </div>
  <input type="hidden" name="destination[lat]" value="<%= @destination.lat %>" />
  <input type="hidden" name="destination[lng]" value="<%= @destination.lng %>" />
  <div class="row">
    <span class="col-lg-offset-2 col-lg-4"><div id="map" style="width: 100%; height: 200px;"></div></span>
    <script>
var map = L.map('map').setView([<%= current_user.store.lat %>, <%= current_user.store.lng %>], 13);
var layer = L.layerGroup();

L.tileLayer('<%= current_user.layer.url %>', {
  maxZoom: 18,
  attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <%= current_user.layer.attribution %>'
}).addTo(map);

  var marker = L.marker(new L.LatLng(<%= @destination.lat %>, <%= @destination.lng %>), {
    icon: L.icon({iconUrl:'<%= asset_path('marker-004499.svg') %>'}), // FIXME https://github.com/axyjo/leaflet-rails/pull/10
    draggable: true,
    destination: <%= @destination.id %>
  }).addTo(map);

    </script>
  </div>
  <div class="row">
    <div class="col-lg-offset-2">
      <%= f.submit class:"btn btn-primary" %>
    </div>
  </div>
<% end %>
