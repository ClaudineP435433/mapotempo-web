<div id="map" class="planning_map"></div>

<div class="box-wrapper">
  <div class="box">
    <div class="pull-right">
      <button type="button" class="btn btn-default btn-sm extend"><i class="icon icon-fullscreen"></i></button>
    </div>
    <h1><%= t '.title' %></h1>

    <%= render 'form' %>
    <!--<button type="button" class="btn btn-primary btn-sm" id="optimize"><i class="icon-gears icon-fixed-width"></i> <%= t '.optimize' %></button>-->
    <div class="btn-group pull-right">
      <button type="button" class="btn btn-default btn-sm dropdown-toggle right export" data-toggle="dropdown" title="<%= t '.exports' %>"><i class="icon-share icon-fixed-width"></i><span class="caret"></span></button>
      <ul class="dropdown-menu" role="menu">
        <li><%= link_to planning_path(@planning) do %><i class="icon-print icon-fixed-width"></i> <%= t '.export.print' %><% end %></li>
        <li><%= link_to planning_path(@planning, format: :csv) do %><i class="icon-table icon-fixed-width"></i> <%= t '.export.spreadsheet' %><% end %></li>
      </ul>
    </div>
    <div id="planning"></div>
  </div>
</div>

<div id="dialog-matrix" title="<%= t '.dialog.matrix.title' %>" style="display:none">
  <div class="dialog-progress">
    <p><%= t '.dialog.matrix.in_progress' %></p>
    <div class="progress progress-striped active">
      <div class="progress-bar" style="width: 0%"></div>
    </div>
  </div>
  <p class="dialog-error" style="display: none"><%= t '.dialog.matrix.error' %></p>
  <p class="dialog-attempts" style="display: none"><%= t '.dialog.matrix.attempts' %> <span class="dialog-attempts-number"></span></p>
</div>

<div id="dialog-optimize" title="<%= t '.dialog.optimizer.title' %>" style="display:none">
  <div class="dialog-progress">
    <p><%= t '.dialog.optimizer.in_progress' %></p>
    <div class="progress progress-striped active">
      <div class="progress-bar" style="width: 0%"></div>
    </div>
  </div>
  <p class="dialog-error" style="display: none"><%= t '.dialog.optimizer.error' %></p>
  <p class="dialog-attempts" style="display: none"><%= t '.dialog.optimizer.attempts' %> <span class="dialog-attempts-number"></span></p>
</div>
<%
controller.js(
  planning_id: @planning.id,
  zoning_id: @planning.zoning ? @planning.zoning.id : nil,
  map_layer_url: current_user.layer.url,
  map_lat: current_user.customer.store.lat,
  map_lng: current_user.customer.store.lng,
  map_attribution: t('all.osm_attribution_html', layer_attribution: current_user.layer.attribution),
  routes_id: @planning.routes.collect{ |route| route.id },
  vehicles_array: current_user.customer.vehicles.collect{ |vehicle|
    {id: vehicle.id, name: vehicle.name, color: vehicle.color}
  },
  vehicles_map: Hash[current_user.customer.vehicles.collect{ |vehicle|
    [vehicle.id, {id: vehicle.id, name: vehicle.name, color: vehicle.color}]
  }]
)
%>
